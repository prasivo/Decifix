<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DECIFIX | Engine</title>

<style>
/* Base Reset & Typography */
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family: 'Segoe UI', Roboto, -apple-system, sans-serif;
}

body{
  background:#050509;
  color:#fff;
  min-height:100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  overflow-x: hidden;
}

/* Background Atmosphere */
body::before {
  content: "";
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: radial-gradient(circle at top right, #1a1a2e 0%, transparent 40%),
              radial-gradient(circle at bottom left, #0c0c14 0%, transparent 40%);
  z-index: -1;
}

/* Main Container */
.container{
  width:94%;
  max-width:700px;
  margin:40px auto;
  padding:40px;
  background: rgba(12, 12, 20, 0.7);
  backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  box-shadow: 0 40px 100px rgba(0,0,0,0.6);
  animation: entrance 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
}

@keyframes entrance {
  from { opacity: 0; transform: scale(0.95) translateY(20px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

/* Header */
.header{
  margin-bottom:30px;
  text-align: center;
}
.title{
  font-size:32px;
  letter-spacing:6px;
  font-weight: 800;
  background: linear-gradient(to right, #fff, #6366f1);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.sub{
  font-size:11px;
  letter-spacing:4px;
  color:#6366f1;
  text-transform: uppercase;
  margin-top:8px;
}

/* Context Box */
.context{
  margin-top:20px;
  padding:18px;
  background: rgba(5, 5, 9, 0.5);
  border-left: 3px solid #6366f1;
  font-size:14px;
  color:#d1d5db;
  font-style: italic;
  animation: fadeIn 1s ease;
}

/* Rule Card */
.rule-box{
  margin-top:30px;
  padding:30px;
  border:1px solid rgba(99, 102, 241, 0.2);
  background: rgba(255, 255, 255, 0.02);
  border-radius: 4px;
  position: relative;
  transition: all 0.5s ease;
}

.rule-meta{
  font-size:10px;
  letter-spacing:3px;
  color:#9ca3af;
  margin-bottom:15px;
  text-transform: uppercase;
}

.question{
  font-size:20px;
  line-height:1.4;
  margin-bottom:25px;
  font-weight: 500;
}

/* Case Styles */
.case{
  border:1px solid rgba(255,255,255,0.05);
  padding:18px;
  margin-bottom:16px;
  font-size:14px;
  background: rgba(0,0,0,0.2);
  transition: 0.3s;
}

.case strong{
  display:block;
  margin-bottom:8px;
  color:#6366f1;
  letter-spacing: 1px;
}

/* Action Buttons */
.actions{
  display:flex;
  gap:15px;
  margin-top:25px;
}

.btn{
  flex:1;
  padding:16px 0;
  background:transparent;
  border:1px solid #6366f1;
  color:#6366f1;
  font-weight: 600;
  letter-spacing:2px;
  cursor:pointer;
  transition: 0.4s;
}

.btn:hover{
  background:#6366f1;
  color:#000;
  box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
}

/* Table Design */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:30px;
  font-size:12px;
  animation: fadeIn 1s ease;
}

th{
  text-transform: uppercase;
  color: #6366f1;
  letter-spacing: 1px;
  border-bottom: 2px solid #222;
}

th, td{
  padding:14px;
  text-align:left;
  border:1px solid #1a1a2e;
}

/* Final Note & Result */
.result h3{
  font-size:28px;
  color: #6366f1;
  margin-bottom:15px;
}

.lock{
  margin-top:40px;
  font-size:13px;
  letter-spacing: 1px;
  color:#6b7280;
  text-align: center;
  border-top: 1px solid #222;
  padding-top: 20px;
}

/* Founder Styling */
.founder-footer{
  margin-top: 30px;
  font-size: 11px;
  letter-spacing: 3px;
  color: #4b5563;
  text-transform: uppercase;
  text-align: center;
}

.hidden{ display:none; }

@keyframes fadeIn {
  from { opacity: 0; } to { opacity: 1; }
}
</style>
</head>

<body>

<div class="container">
  <div class="header">
    <div class="title" id="domainTitle">DECIFIX</div>
    <div class="sub">FILTRATION ENGINE</div>
  </div>

  <div class="context" id="userContext">
    Analyzing your situation...
  </div>

  <div id="ruleSection" class="rule-box">
    <div class="rule-meta" id="ruleMeta">STEP ACTIVE</div>

    <div class="question" id="ruleQuestion">...</div>

    <div class="case">
      <strong>CHOICE: YES</strong>
      <span id="positive"></span>
    </div>

    <div class="case">
      <strong>CHOICE: NO</strong>
      <span id="negative"></span>
    </div>

    <div class="actions">
      <button class="btn" onclick="choose(true)">YES</button>
      <button class="btn" onclick="choose(false)">NO</button>
    </div>
  </div>

  <div id="resultSection" class="result hidden">
    <h3 id="finalVerdict"></h3>
    <div class="note" id="finalNote"></div>

    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Question</th>
          <th>Choice</th>
        </tr>
      </thead>
      <tbody id="summaryTable"></tbody>
    </table>

    <div class="lock">
      NO REGRETS • MOVEMENT IS LIFE • DECISION IS FINAL
    </div>
  </div>

  <div class="founder-footer">
    FOUNDER: PRASOON GUPTA
  </div>
</div>

<script src="domain-map.js"></script>

<script>
// Logic preserved from your original code
function detectDomain(text){
  if(!text) return "general";
  const t = text.toLowerCase();
  for (let domain in DOMAIN_MAP) {
    const d = DOMAIN_MAP[domain];
    if (d.intent) {
      for (let phrase of d.intent) {
        if (t.includes(phrase)) return domain;
      }
    }
  }
  for (let domain in DOMAIN_MAP) {
    const d = DOMAIN_MAP[domain];
    if (d.keywords) {
      for (let word of d.keywords) {
        if (t.includes(word)) return domain;
      }
    }
  }
  return "general";
}

const situation = localStorage.getItem("decifix_situation") || "";
if (situation) {
  document.getElementById("userContext").innerText = "“" + situation + "”";
}

const basePath = location.pathname.split("/")[1] || "";
const domainName = detectDomain(situation);
const domainScript = document.createElement("script");
domainScript.src = `/${basePath}/domains/${domainName}.js`;

domainScript.onload = () => {
  const engineScript = document.createElement("script");
  engineScript.src = `/${basePath}/engine.js`;
  document.body.appendChild(engineScript);
};

document.body.appendChild(domainScript);

// Added a small visual transition for the choices
function choose(val){
  const box = document.getElementById('ruleSection');
  box.style.opacity = '0.3';
  box.style.transform = 'scale(0.98)';
  
  setTimeout(() => {
    // This calls the 'choose' function inside your engine.js
    if(window.engineChoose){
        window.engineChoose(val);
    } else {
        // Fallback if engine.js hasn't renamed the function
        choose(val); 
    }
    box.style.opacity = '1';
    box.style.transform = 'scale(1)';
  }, 300);
}
</script>

</body>
</html>
